<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å¸ˆå­¦ç”Ÿä»»åŠ¡ç®¡ç†</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 20%;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
        }
        .student {
            padding: 10px;
            cursor: pointer;
        }
        .student:hover {
            background-color: #34495e;
        }
        .content {
            width: 80%;
            padding: 20px;
        }
        .task {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .high-priority {
            color: red;
            font-weight: bold;
        }
        .low-priority {
            color: green;
        }
        .deadline {
            font-size: 12px;
            color: gray;
        }
        .status {
            font-size: 30px;
        }
        .crying {
            color: red;
        }
        .happy {
            color: green;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
        }
        .close {
            float: right;
            cursor: pointer;
        }
    </style>
    <script>
        let rewardTasks = [];

        const students = {
            "Aå­¦ç”Ÿ": [
                { title: "æ¨ªå‘é¡¹ç›®ï¼šXXå…¬å¸åˆä½œ", priority: "é«˜ä¼˜å…ˆçº§", deadline: "2024-09-25" },
                { title: "å®Œæˆå®éªŒæŠ¥å‘Š", priority: "é«˜ä¼˜å…ˆçº§", deadline: "2024-10-01" },
                { title: "ç”³æŠ¥å›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘", priority: "ä¸­ä¼˜å…ˆçº§", deadline: "2024-11-20" },
                { title: "é˜…è¯»æ–‡çŒ®", priority: "ä½ä¼˜å…ˆçº§", deadline: "2024-12-01" }
            ],
            "Bå­¦ç”Ÿ": [
                { title: "æ’°å†™è®ºæ–‡åˆç¨¿", priority: "é«˜ä¼˜å…ˆçº§", deadline: "2024-09-15" },
                { title: "æ¨ªå‘é¡¹ç›®ï¼šä¸XXå…¬å¸åˆä½œ", priority: "é«˜ä¼˜å…ˆçº§", deadline: "2024-09-28" },
                { title: "ä¸ºå¯¼å¸ˆå¡«å†™é¡¹ç›®ç”³è¯·è¡¨", priority: "ä¸­ä¼˜å…ˆçº§", deadline: "2024-10-10" },
                { title: "æ•´ç†ä¼šè®®è®°å½•", priority: "ä½ä¼˜å…ˆçº§", deadline: "2024-12-05" }
            ],
            "Cå­¦ç”Ÿ": [
                { title: "å‚ä¸å¯¼å¸ˆç ”ç©¶è¯¾é¢˜", priority: "é«˜ä¼˜å…ˆçº§", deadline: "2024-09-20" },
                { title: "å‡†å¤‡æœŸæœ«è€ƒè¯•ææ–™", priority: "ä¸­ä¼˜å…ˆçº§", deadline: "2024-11-30" },
                { title: "é˜…è¯»ç›¸å…³æ–‡çŒ®", priority: "ä½ä¼˜å…ˆçº§", deadline: "2024-12-15" }
            ]
        };

        function calculateDaysLeft(deadline) {
            const deadlineDate = new Date(deadline);
            const today = new Date();
            const timeDiff = deadlineDate - today;
            const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
            return daysLeft > 0 ? daysLeft : 0;
        }

        function loadTasks(studentName) {
            const taskList = students[studentName];
            const contentDiv = document.querySelector(".content");
            contentDiv.innerHTML = `<h2>${studentName}çš„ä»»åŠ¡</h2>`;
            
            // æ˜¾ç¤ºå·²æœ‰ä»»åŠ¡
            taskList.forEach(task => {
                const daysLeft = calculateDaysLeft(task.deadline);
                contentDiv.innerHTML += `
                <div class="task">
                    <h3>${task.title} <span class="${task.priority === 'é«˜ä¼˜å…ˆçº§' ? 'high-priority' : 'low-priority'}">${task.priority}</span></h3>
                    <p class="deadline">æˆªæ­¢æ—¥æœŸ: ${task.deadline}ï¼ˆè¿˜æœ‰ ${daysLeft} å¤©ï¼‰</p>
                </div>`;
            });

            // æ˜¾ç¤ºæ‚¬èµä»»åŠ¡
            rewardTasks.forEach(task => {
                if (task.acceptedBy === studentName || task.acceptedBy === null) {
                    const status = task.acceptedBy === null ? `<button onclick="acceptTask('${studentName}', '${task.title}')">æ¥å—ä»»åŠ¡</button>` : `<span class="accepted">å·²æ¥å—</span>`;
                    const daysLeft = task.deadline ? calculateDaysLeft(task.deadline) : "æ— ";
                    contentDiv.innerHTML += `
                    <div class="task">
                        <h3>${task.title} <span class="high-priority">æ‚¬èµ</span></h3>
                        <p>${task.details}</p>
                        <p>é‡‘é¢: Â¥${task.reward}</p>
                        <p>æˆªæ­¢æ—¥æœŸ: ${task.deadline ? `${task.deadline}ï¼ˆè¿˜æœ‰ ${daysLeft} å¤©ï¼‰` : 'æ— '}</p>
                        ${status}
                    </div>`;
                }
            });

            // æ·»åŠ è¡¨æƒ…çŠ¶æ€
            const taskCount = taskList.length + rewardTasks.filter(task => task.acceptedBy === studentName).length;
            if (taskCount >= 4) {
                contentDiv.innerHTML += `<div class="status crying">ğŸ˜­ ä»»åŠ¡å¤ªå¤šäº†ï¼</div>`;
            } else {
                contentDiv.innerHTML += `<div class="status happy">ğŸ˜Š ä»»åŠ¡ä¸å¤šï¼Œå¯ä»¥æ”¾æ¾ä¸€ä¸‹ï¼</div>`;
            }
        }

        function addRewardTask() {
            // è®¾ç½®é»˜è®¤å€¼
            const defaultTitle = "çŒ›çŒ›å¹²æ´»ï¼Œç»™å¼ è€å¸ˆå‘paper";
            const defaultDetails = "ååŠ©å¼ è€å¸ˆå®Œæˆè®ºæ–‡æäº¤ï¼Œæ•´ç†æ–‡æ¡£å’Œæ ¼å¼æ£€æŸ¥ã€‚";
            const defaultReward = 100;
            const defaultDeadline = new Date();
            defaultDeadline.setDate(defaultDeadline.getDate() + 7); // 7å¤©å

            document.getElementById("taskTitle").value = defaultTitle;
            document.getElementById("taskDetails").value = defaultDetails;
            document.getElementById("taskReward").value = defaultReward;
            document.getElementById("taskDeadline").value = defaultDeadline.toISOString().split('T')[0];

            const modal = document.getElementById("taskModal");
            modal.style.display = "flex";
        }

        function submitRewardTask() {
            const title = document.getElementById("taskTitle").value;
            const details = document.getElementById("taskDetails").value;
            const reward = document.getElementById("taskReward").value;
            const deadline = document.getElementById("taskDeadline").value || null;
            
            rewardTasks.push({ title, details, reward, deadline, acceptedBy: null });
            
            document.getElementById("taskModal").style.display = "none";
            alert("æ‚¬èµä»»åŠ¡å·²æ·»åŠ ï¼");
        }

        function acceptTask(studentName, taskTitle) {
            rewardTasks = rewardTasks.map(task => {
                if (task.title === taskTitle && !task.acceptedBy) {
                    task.acceptedBy = studentName;
                    alert(`${studentName} å·²æ¥å—ä»»åŠ¡: ${taskTitle}`);
                }
                return task;
            });
            loadTasks(studentName); // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
        }

        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".student").forEach(student => {
                student.addEventListener("click", (event) => {
                    loadTasks(event.target.textContent);
                });
            });

            // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªå­¦ç”Ÿçš„ä»»åŠ¡
            loadTasks("Aå­¦ç”Ÿ");

            // æ·»åŠ æ‚¬èµä»»åŠ¡æŒ‰é’®
            const addTaskButton = document.createElement('button');
            addTaskButton.innerText = 'æ·»åŠ æ‚¬èµä»»åŠ¡';
            addTaskButton.onclick = addRewardTask;
            document.body.appendChild(addTaskButton);
        });
    </script>
</head>
<body>
    <div class="sidebar">
        <h2>å­¦ç”Ÿåˆ—è¡¨</h2>
        <div class="student">Aå­¦ç”Ÿ</div>
        <div class="student">Bå­¦ç”Ÿ</div>
        <div class="student">Cå­¦ç”Ÿ</div>
    </div>
    <div class="content">
        <!-- ä»»åŠ¡å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
    </div>

    <!-- æ‚¬èµä»»åŠ¡å¼¹å‡ºæ¡† -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('taskModal').style.display='none'">&times;</span>
            <h2>æ·»åŠ æ‚¬èµä»»åŠ¡</h2>
            <label for="taskTitle">ä»»åŠ¡æ ‡é¢˜:</label><br>
            <input type="text" id="taskTitle" placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜"><br><br>
            <label for="taskDetails">ä»»åŠ¡è¯¦æƒ…:</label><br>
            <textarea id="taskDetails" rows="4" placeholder="è¯·è¾“å…¥ä»»åŠ¡è¯¦æƒ…"></textarea><br><br>
            <label for="taskReward">æ‚¬èµé‡‘é¢ (Â¥):</label><br>
            <input type="number" id="taskReward" placeholder="é‡‘é¢"><br><br>
            <label for="taskDeadline">æˆªæ­¢æ—¥æœŸ (å¯é€‰):</label><br>
            <input type="date" id="taskDeadline"><br><br>
            <button onclick="submitRewardTask()">æäº¤ä»»åŠ¡</button>
        </div>
    </div>
</body>
</html>